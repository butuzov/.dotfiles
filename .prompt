export TERM="xterm-color"

# How it looks
# https://misc.flogisoft.com/bash/tip_colors_and_formatting
WHITE="\[\e[107;30m\]"
BG_GREEN="\[\e[102;30m\]"
BG_BLUE="\[\e[104;30m\]"
BG_YELLOW="\[\e[103;30m\]"
YELLO="\[\e[1;33m\]"
RESET="\[\e[0m\]"


echo -e "\033]6;1;bg;red;brightness;40\a" > /dev/null
echo -e "\033]6;1;bg;green;brightness;40\a" > /dev/null
echo -e "\033]6;1;bg;blue;brightness;40\a" > /dev/null


# Kubernetes
KUBE_CONTEXT=~/.kubernetes
kube_ctx(){
  [ -f "${KUBE_CONTEXT}" ] && unlink "${KUBE_CONTEXT}" || touch "${KUBE_CONTEXT}" ;
  if [[ ! -f "${KUBE_CONTEXT}" ]]; then
    echo "KubeCtx is off"
  else
    echo "KubeCtx is on"
  fi
}

kube_ctx_check(){

    if [[ ! -f "${KUBE_CONTEXT}" ]]; then
        return 0;
    fi

    CURRENT_CTX=$(kubectl config view | grep [c]urrent-context | awk '{print $2}' | sed 's/\"//g')
    if [[ ! -z $CURRENT_CTX ]]; then
        CURRENT_NS=$(kubectl config view --minify --output 'jsonpath={..namespace}')
    else
        return 0;
    fi

    if [[ ! -z $CURRENT_NS ]]; then
        printf " ⎈ %s@%s " "$CURRENT_CTX" "$CURRENT_NS"
    else
        printf " ⎈ %s " "$CURRENT_CTX"
    fi
}

# Git
GIT_CONTEXT=~/.gitcontext
git_ctx(){
  [ -f "${GIT_CONTEXT}" ] && unlink "${GIT_CONTEXT}" || touch "${GIT_CONTEXT}" ;
  if [[ ! -f "${GIT_CONTEXT}" ]]; then
    echo "GitCtx is off"
  else
    echo "GitCtx is on"
  fi
}


git_ctx_check(){
    if [[ ! -f "${GIT_CONTEXT}" ]]; then
        return 0;
    fi

    BRANCH=$(git branch --no-color 2>/dev/null | cut -d' ' -f 2 | xargs )

    if [[ -z $BRANCH ]]; then
        return 0;
    fi

    printf "  %s " "$BRANCH"

}


ctx() {

    case "$1" in
        "git")    git_ctx  ;;
        "kube")   kube_ctx  ;;

        # mac issue require us to run it as .
        *)   echo "Context not found";
    esac

}



PS1="${RESET}"
PS1+="${WHITE} $ \u ${RESET}"
PS1+="${BG_BLUE}\$(kube_ctx_check)${RESET}"
PS1+="${BG_GREEN} \w ${RESET}"
PS1+="${BG_YELLOW}\$(git_ctx_check)${RESET}"
PS1+="\n${YELLO} > ${RESET}"
export PS1=$PS1


# exporting prompt

export SUDO_PS1="${RESET}${WHITE} # \u@\h ${GREEN} \w ${RESET} \n${YELLO} > ${RESET}";

export CLICOLOR=1l
export LSCOLORS=ExFxBxDxCxegedabagacad

export LC_CTYPE="UTF-8"
export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8
