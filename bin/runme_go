#!/usr/bin/env bash

# vsc code runner for go files and running them with cmd+r

runme_go(){
    FILE="${1}"
    if [[ "${FILE}" =~ "_test.go" ]]; then
        cd "$(dirname "${FILE}")"
        go test -race -timeout 30s -run $(cat "${FILE}" | sed -n 's/func.*\(Test.*\)(.*/\1/p' | xargs | sed 's/ /|/g') -v
        exit $?
    fi

    if [[ $(basename "${FILE}") == "main.go" ]]; then

        cd "$(dirname "${FILE}")"
        go run .
        exit $?
    fi

    go run "${FILE}"
    exit $?
}

runme_go $1
